defmodule Prime do

    @number 7777731073919171
    @number2  7355573

    @matrix4x4 2727344827935482 # 0.52 seconds
    @matrix5x5 2216734827935482546294839 #
    @matrix6x6 2785634802635482546294839458301728 #
    @matrix7x7 2785634827935482546294839851424590627421590453194 #
    @matrix10x10 2216734827935482546294839221673482793548254629483922167348279354825462948392216734827935482546294839 # 0.64 seconds
    @matrix55x55 111110000001111222222222233444444433221100000000000000011111000000111122222222233344444443322110000000000000001111100000011112222222223334444444332211000000000000000111110000001111122222223333444444433321100000000000000011111000000111112222223333344444444332211000000000000001111000000111111222222333344444444443321100000000000000000000000111111112222333344444444444332110000000000000000000000011111111122233344444444444443211000000000000000000000001111111112223334444444455544322100000000000000000000000111111111122334444444455554433211000000000000000000000011111111112233444444455555543321100000000000000000000001111111111223344445555555554432110000000000000000000000000001111122334445555555555443211100000000000000000000000000011111233444555555555544321110000000000000000000000000000111123344555555555544432111000000000000000000000000000011112334455555555554433211000000000000000000000000000000111233445555555555443321100000000000000000000000000000011123344555555555444322110000000000000000000000000000001112334455566655544332111000000000000000000000000000000111223445566665554433211000000000000000000000000000000011122344556666655443221100000000000000000000000000000001112234455666665543322110000000000000000000000000000000011223445566666544332110000000000000000000000000000000011122334556666654432211000000000000000000000000000001111122233445566665433221100000000000000011111111111111111122233344556665543322111000000000000001111111111111222222333334445555554332211100000000000000111111112222223333333333444455554433222111000000000000011122222233333344444444434444444443332211111100000000002222223333344445555555443334444444333322211111100000000222233334444555566666554433333344444333222211111000000023333344455556666776665444333333444444333222211110000003333444555666667777766554433333344444444333322111100000444445556666677777777655444333334444555444433221111000044455566677777777777766554433333444555555544332211110005555566677777778887776655444333344555566655443222111100555566677778888888877766554433334455566666554332211111155566677788888888887776655443333445566666665433221111115556667778888888888777665544333344556667766543322111111

    def time(num) do
        Process.flag(:trap_exit, true)
        {algo, val} = :timer.tc(fn -> tod(num) end)
        algo = algo/1000000
        IO.inspect {"Time in seconds: ",algo,val}
    end

    def tod(num) do
        Process.register(self(), :main)
        cond do
            rem(num,2) == 0 -> cond do
                                   String.ends_with?(Integer.to_string(num+1),"5") -> principal(num+3)
                                   true -> principal(num+1)
                                end
            String.ends_with?(Integer.to_string(num),"5") -> principal(num+2)
            true -> principal(num)
        end
    end
    
    def principal(num) do
        Process.flag(:trap_exit, true)
        pid = spawn_link(fn -> Fast.main(num, 10, 40000) end)
        receive do
            {:prime, num2} -> IO.inspect {:prime,num2};if Process.alive?(pid) == true do Process.exit(pid, :kill) end;Process.unregister(:main);Process.exit(self(), :normal)
            {:nonprime, num2} -> cond do
                                String.ends_with?(Integer.to_string(num2+2),"5") -> principal(num2+4);
                                true -> principal(num2+2);
                        end
        end
    end
end