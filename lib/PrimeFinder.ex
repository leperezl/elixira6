defmodule Prime do

    @number 7777731073919171
    @number2  7355573
    @cores :erlang.system_info(:logical_processors_available)

    @matrix4x4 2727344827935482 # 0.52 seconds
    @matrix5x5 2216734827935482546294839 #
    @matrix6x6 2785634802635482546294839458301728 #
    @matrix7x7 2785634827935482546294839851424590627421590453194 #
    @matrix10x10 2216734827935482546294839221673482793548254629483922167348279354825462948392216734827935482546294839 # 0.64 seconds
    @matrix45x45 111100000111222222223344444432211000000000000111100000111222222223344444433211000000000000111100000111122222233344444433211000000000000111100000111122222333344444433221000000000000111000001111122222333444444443321000000000000000000011111112223334444444444321100000000000000000011111111223334444444444321100000000000000000011111111223344444445554322100000000000000000011111111223344444455554432100000000000000000011111111123344555555554432110000000000000000000001111122344555555554432110000000000000000000000011122344555555554432110000000000000000000000011122344555555554432110000000000000000000000001122345555555544332110000000000000000000000001122345555555544322100000000000000000000000001122345556655544321100000000000000000000000001122345566665543321100000000000000000000000001122345566665543221000000000000000000000000001122344566665443211000000000000000000000000011122344556665433211000000000000111000000111111222334556665433211000000000000111111111111222233334455555433211000000000000111111122222333333334445554433221100000000000112222233333444544443444444433221111110000000222223334444555555443334444443332211111000000223334445555666665544333334444333222111100000333444555666677766544333334444443332221110000444455666677777776554433334445554443322111000445556677777777776654443334455555554332111100555566777778888777655443334455566655432211111555667778888888877655443334455666665432211111555667788888888877665443334455667665432211111 
    #Prime tried
    #111100000111222222223344444432211000000000000111100000111222222223344444433211000000000000111100000111122222233344444433211000000000000111100000111122222333344444433221000000000000111000001111122222333444444443321000000000000000000011111112223334444444444321100000000000000000011111111223334444444444321100000000000000000011111111223344444445554322100000000000000000011111111223344444455554432100000000000000000011111111123344555555554432110000000000000000000001111122344555555554432110000000000000000000000011122344555555554432110000000000000000000000011122344555555554432110000000000000000000000001122345555555544332110000000000000000000000001122345555555544322100000000000000000000000001122345556655544321100000000000000000000000001122345566665543321100000000000000000000000001122345566665543221000000000000000000000000001122344566665443211000000000000000000000000011122344556665433211000000000000111000000111111222334556665433211000000000000111111111111222233334455555433211000000000000111111122222333333334445554433221100000000000112222233333444544443444444433221111110000000222223334444555555443334444443332211111000000223334445555666665544333334444333222111100000333444555666677766544333334444443332221110000444455666677777776554433334445554443322111000445556677777777776654443334455555554332111100555566777778888777655443334455566655432211111555667778888888877655443334455666665432211111555667788888888877665443334455667665432215007  
    #Prime found

    def time(num) do
        Process.flag(:trap_exit, true)
        {algo, val} = :timer.tc(fn -> tod(num) end)
        algo = algo/1000000
        IO.inspect {"Time in seconds: ",algo,val}
    end

    def tod(num) do
        Process.register(self(), :main)
        cond do
            rem(num,2) == 0 -> cond do
                                   String.ends_with?(Integer.to_string(num+1),"5") -> principal(num+3)
                                   true -> principal(num+1)
                                end
            String.ends_with?(Integer.to_string(num),"5") -> principal(num+2)
            true -> principal(num)
        end
    end

    def principal(num) do
        Process.flag(:trap_exit, true)
        pid = spawn_link(fn -> Fast.main(num, 10, @cores) end)
        receive do
            {:prime, num2} -> IO.inspect {:prime,num2};if Process.alive?(pid) == true do Process.exit(pid, :kill) end;Process.unregister(:main);Process.exit(self(), :normal)
        end
    end
end